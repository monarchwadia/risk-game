const e=(e,t)=>({x:e,y:t}),t=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),r=(e,t,r)=>{for(let o=e;o<=t;o++)r(o)},o=e=>{if(0===e.length)return;const t=s(e.length-1);return void 0!==t?e[t]:void 0},s=e=>Math.floor(Math.random()*e);var a=e=>{e.players.forEach((e=>{if(s(10)>=e.cells.length/100)return;const t=e.cells.length,r=s(t);e.cells.splice(r,1)}))};class n{add(e,t,r){this.tree[e]||={},this.tree[e][t]=r}remove(e,t){this.tree[e]&&this.tree[t]&&(delete this.tree[e][t],Object.keys(this.tree[e]).length||delete this.tree[e])}get(e,t){if(this.has(e,t))return this.tree[e][t]}has(e,t){if(!Object.prototype.hasOwnProperty.call(this.tree,""+e))return!1;return!!Object.prototype.hasOwnProperty.call(this.tree[e],""+t)}modify(e,t,r){const o=r(this.get(e,t));void 0!==o&&this.add(e,t,o)}toArray(){const e=[];return Object.keys(this.tree).forEach((t=>{Object.keys(this.tree[t]).forEach((r=>{e.push({x:+t,y:+r,val:this.tree[t][r]})}))})),e}constructor(){this.tree={}}}var l=(t,o,s)=>{const a=new n;t.cells.forEach((e=>{r(-1,1,(t=>{r(-1,1,(r=>{a.add(e.x+t,e.y+r,!0)}))}))})),t.cells.forEach((e=>{a.remove(e.x,e.y)}));const l=a.toArray().filter((e=>!0===e.val)),c=new n;l.forEach((({x:t,y:r})=>{if(s.has(t,r)){const o=s.get(t,r);if(!o)return;c.add(t,r,{type:"ATTACK",targetCell:{coords:e(t,r),owner:o}})}else c.add(t,r,{type:"COLONIZE",targetCell:{coords:e(t,r)}})}));const i=c.toArray().map((e=>e.val));return i.push({type:"PASS"}),i};var c=e=>{const t=new n;e.players.forEach((e=>{e.cells.forEach((r=>{t.add(r.x,r.y,e)}))})),e.players.forEach((r=>{const o=l(r,e,t),s=r.ai({player:r,state:e,possibleMoves:o,occupiedCells:t});switch(s.type){case"ATTACK":s.targetCell.owner.cells=s.targetCell.owner.cells.filter((e=>e.x!==s.targetCell.coords.x||e.y!==s.targetCell.coords.y));break;case"COLONIZE":r.cells.push(s.targetCell.coords)}})),a(e)};var i=({state:e})=>{const r=document.getElementById("canvas").getContext("2d");r&&e.players.forEach((o=>{o.cells.forEach((s=>{((e,r,o,s)=>{const{x:a,y:n}=t(r,s.origin);e.strokeStyle=o,e.fillStyle=o,e.fillRect(a*s.zoom,n*s.zoom,s.zoom-1,s.zoom-1)})(r,s,o.color,e.camera)}))}))};var d=()=>{const e=document.getElementById("canvas");if(!e)return;const t=window.innerWidth,r=window.innerHeight;e.setAttribute("height",""+r),e.setAttribute("width",""+t)};var h=(e,r)=>{let o,s,a,n=!1;const l=document.getElementById("canvas");l.addEventListener("mousedown",(function(t){console.log("mousedown"),n=!0,s={x:t.clientX,y:t.clientY},a={...e.camera.origin}})),l.addEventListener("mousemove",(l=>{if(!n)return;console.log("mousemove");const c={x:l.clientX,y:l.clientY},i=t(c,s);o=e.camera.origin,e.camera.origin=t(a,i),r()})),l.addEventListener("wheel",(t=>{console.log("wheel event triggered");const o=t;t.preventDefault();const s=0===o.deltaY?0:o.deltaY>0?1:-1;e.camera.zoom=Math.min(Math.max(e.camera.zoom+s,3),7),r()})),l.addEventListener("mouseup",(()=>{console.log("mouseup"),n=!1,o&&(e.camera.origin=o)}))};var y=({canvas:e})=>{e.getContext("2d")?.clearRect(0,0,e.width,e.height)};var m=({possibleMoves:e})=>{let t;const r=e.filter((e=>"ATTACK"===e.type));return t=r.length?o(r):o(e),t||(t={type:"PASS"}),t};var v=({possibleMoves:e})=>{let t;return t=o(e.filter((e=>"ATTACK"!==e.type))),t||(t={type:"PASS"}),t};const g=document.getElementById("canvas"),u={players:[{color:"blue",ai:v,cells:[e(20,20)]},{color:"red",ai:m,cells:[e(15,15)]},{color:"green",ai:m,cells:[e(25,25)]}],camera:{origin:e(-100,-100),zoom:5}};setInterval((()=>c(u)),1);const p=()=>{y({canvas:g}),i({state:u,canvas:g}),requestAnimationFrame(p)};requestAnimationFrame(p),window.addEventListener("resize",(()=>{d(),y({canvas:g})})),d(),h(u,(()=>{y({canvas:g})}));
//# sourceMappingURL=index.cc705d55.js.map
